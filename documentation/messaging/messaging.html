<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Messaging Basics | Composable </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Messaging Basics | Composable ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/mlidbom/Composable/blob/docfx/Website/documentation/messaging/messaging.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Composable">
            Composable
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="messaging-basics">Messaging Basics</h1>

<p>NOTE: The code blocks in this section contain pseudocode for illustration purposes.
It is not compatible with any specific library including Composable.</p>
<h2 id="messaging">Messaging</h2>
<p>Any method call can, if you squint, be viewed as one object sending a message to another object.
However, this ties the sender tightly to the receiver.
Loose coupling benefits can be had by making the message passing explicit.
By sending messages to a receiver through some intermediary rather than directly.
Doing so is called messaging.</p>
<div class="TIP">
<h5>Tip</h5>
<p>Messaging is also known as message passing.</p>
</div>
<h3 id="messaging-terms">Messaging terms</h3>
<p>Here we define some terms as they are used in the context of this document.</p>
<p><strong>Message</strong><br>
An object for the purpose of sending data to a receiver.</p>
<p><strong>Message Type</strong><br>
The System.Type returned by <code>message.GetType()</code>.</p>
<p><strong>Message Handler</strong><br>
In principle just a function that takes a message as a parameter.</p>
<blockquote>
<pre><code>void Handle(RegisterAccountCommand command);
</code></pre>
</blockquote>
<p>In practice most message handlers need to have one or more dependencies injected into them.
In order to support this handlers are often required to be wrapped inside interfaces.
That way instances of implementing classes can be resolved from an IOC container easily.</p>
<blockquote>
<pre><code>interface IMessageHandler&lt;RegisterAccountCommand&gt;
{
    void Handle(RegisterAccountCommand aMessage);
}
</code></pre>
</blockquote>
<p><strong>Routing</strong><br>
The mechanism by which messages are delivered to handlers.</p>
<p><strong>Service Bus</strong>
A component which decouples message senders from message handlers.
Instead of client code calling handler methods, clients send and receive messages via the bus.
The bus is responsible for routing the messages to the appropriate handler(s) and invoking them.</p>
<p>.Manual service invocation requires an instance of the service.</p>
<blockquote>
<pre><code>serviceInstance.RegisterAccount(arguments....
</code></pre>
</blockquote>
<p>.Client don't even know where the service is when accessing it across a bus</p>
<blockquote>
<pre><code>bus.Send(new RegisterAccountCommand(
</code></pre>
</blockquote>
<div class="TIP">
<h5>Tip</h5>
<p>The benefits of this decoupling may not be obvious at first, but they are profound.</p>
</div>
<p><strong>Command</strong><br>
A message that instructs the handler to perform an action.</p>
<blockquote>
<pre><code>class RegisterAccountCommand
{
    AccountId AccountId { get; }
    Password Password { get; }
    Email Email { get; }
}
</code></pre>
</blockquote>
<hr>
<p><strong>Event</strong><br>
A message that informs handlers about something that has happened.</p>
<blockquote>
<pre><code>interface IAccountRegisteredEvent
{
    AccountId AccountId { get; }
    Password Password { get; }
    Email Email { get; }
}
</code></pre>
</blockquote>
<p><strong>Query</strong><br>
A message that asks the handler to supply some data.</p>
<blockquote>
<pre><code>class RecentlyRegisteredAccountsQuery
{
    TimeSpan MaxAge { get; }
}
</code></pre>
</blockquote>
<p><strong>Command Handler</strong></p>
<blockquote>
<pre><code>A message handler for a command. Must ensure that the command is successfully executed or throw an exception.
</code></pre>
</blockquote>
<p><strong>Query Handler</strong></p>
<blockquote>
<pre><code>A message handler for a query. Must ensure that the query is successfully executed or throw an exception.
</code></pre>
</blockquote>
<p><strong>Event Handler</strong><br>
A message handler for an event.</p>
<p><strong>Event Listener</strong><br>
Synonym of Event Handler.</p>
<p><strong>Subscribe</strong><br>
The action of registering an Event Handler with a service bus.</p>
<p><strong>Subscriber</strong><br>
An event handler registered on a service bus.</p>
<p><strong>Sending a command or query</strong><br>
Asking a service bus to deliver a message to its handler.</p>
<p><strong>Publishing an event</strong><br>
Delivering an event to all it's subscribers.</p>
<p><strong>Raising an event</strong><br>
Same as Publishing an event</p>
<div class="TIP">
<h5>Tip</h5>
<p>You always publish/Raise events.
Keeping Send separate from Publish in your mind is fundamental to understanding.</p>
</div>
<h3 id="semantic-routing">Semantic Routing</h3>
<p>NOTE: Semantic routing is used throughout the toolkit. It is foundational for the Event Store, Service Bus, Query Model updaters and Generators...</p>
<h4 id="definition">Definition</h4>
<ul>
<li>Messages are delivered to every registered handler with a compatible argument type.</li>
<li>Commands and query message types must have exactly one handler.</li>
</ul>
<div class="TIP">
<h5>Tip</h5>
<p>The first rule is really just polymorphism.</p>
</div>
<div class="TIP">
<h5>Tip</h5>
<p>Semantic Routing is also known as &quot;Polymorphic routing&quot; or &quot;Polymorphic  dispatching&quot;.</p>
</div>
<h4 id="clarifying-examples">Clarifying examples</h4>
<p>Given these event interfaces and implementing classes</p>
<blockquote>
<pre><code>interface IA
interface IB : IA
interface IC : IB

class A : IA {}
class B : IB {}
class C : IC {}
</code></pre>
</blockquote>
<p>And these handler methods registered on our service bus</p>
<blockquote>
<pre><code>void HandleA(IA ia){} //Handles IA, IB and IC
void HandleB(IB ib){} //Handles IB and IC
void HandleC(IC ic){} //Handles only IC
</code></pre>
</blockquote>
<p>.Let's publish some events and examine the results.</p>
<blockquote>
<pre><code>serviceBus.Publish(new A()); //Delivered to HandleA
serviceBus.Publish(new B()); //Delivered to HandleA and HandleB
serviceBus.Publish(new C()); //Delivered to HandleA, HandleB and HandleC
</code></pre>
</blockquote>
<h4 id="loose-coupling-through-interfaces">Loose coupling through interfaces</h4>
<p>Working with events in terms of interfaces maintains flexibility.
Here is a partial list of things it is possible to do without having to change any code in any event listener.</p>
<ul>
<li>Refactoring event classes</li>
<li>Adding event classes</li>
<li>Adding event interfaces</li>
<li>Changing event inheritance hierarchy</li>
</ul>
<div class="TIP">
<h5>Tip</h5>
<p>Remember to think about events in terms of interfaces. The event classes are an implementation detail that should only ever be known by the code that publishes the event.</p>
</div>
<div class="WARNING">
<h5>Warning</h5>
<p>Do not subscribe to event classes. You will lose the benefits just discussed.</p>
</div>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/mlidbom/Composable/blob/docfx/Website/documentation/messaging/messaging.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
